---
import BlogFooter from '@/components/BlogFooter.astro'
import Breadcrumb from '@/components/Breadcrumb.astro'
import { t } from '@/i18n/ui'
import HomeLayout from '@/layouts/HomeLayout.astro'

import '@/styles/global.css'

interface BreadcrumbItem {
  label: string
  href: string
}

interface Props {
  title: string
  breadcrumb?: {
    overrides?: [BreadcrumbItem, ...BreadcrumbItem[]]
  }
}

const { title, breadcrumb } = Astro.props

function getBreadcrumbItems(pathname: string) {
  const locale = Astro.params.locale || 'en'
  const items = [{ href: `/${locale}/`, label: t('nav.home') }]
  if (pathname !== `/${locale}/`) {
    const segments = pathname.split('/').filter(Boolean).slice(1) // remove locale
    segments.forEach((segment, index) => {
      const href = `/${locale}/${segments.slice(0, index + 1).join('/')}`
      const label
        = t(`nav.${segment}`, { returnEmptyString: true })
          || segment.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase())

      items.push({
        href: `${href}/`,
        label,
      })
    })
  }
  return items
}

const breadcrumbItems = getBreadcrumbItems(Astro.url.pathname).map((item) => {
  const override = breadcrumb?.overrides?.find(o => o.href === item.href)
  return override ?? item
})
---

<HomeLayout title={title}>
  <main class="container mx-auto flex-1 px-4 py-8">
    <Breadcrumb items={breadcrumbItems} />
    <slot />
  </main>
  <BlogFooter />
</HomeLayout>
