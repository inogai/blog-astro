---
import BlogFooter from '@/components/BlogFooter.astro'
import Breadcrumb from '@/components/Breadcrumb.astro'
import HomeLayout from '@/layouts/HomeLayout.astro'

import '@/styles/global.css'

interface BreadcrumbItem {
  label: string
  href: string
}

interface Props {
  title: string
  breadcrumb: {
    overrides?: [BreadcrumbItem, ...BreadcrumbItem[]]
  }
}

const { title, breadcrumb } = Astro.props

function getBreadcrumbItems(pathname: string) {
  const items = [{ href: '/', label: 'Home' }]
  if (pathname !== '/') {
    const segments = pathname.split('/').filter(Boolean)
    segments.forEach((segment, index) => {
      const href = `/${segments.slice(0, index + 1).join('/')}`
      const label
        = segment.charAt(0).toUpperCase() + segment.slice(1).replace(/-/g, ' ')

      items.push({
        href: `${href}/`,
        label,
      })
    })
  }
  return items
}

const breadcrumbItems = getBreadcrumbItems(Astro.url.pathname).map((item) => {
  const override = breadcrumb?.overrides?.find(o => o.href === item.href)
  return override ?? item
})
---

<HomeLayout title={title}>
  <main class="container mx-auto flex-1 px-4 py-8">
    <Breadcrumb items={breadcrumbItems} />
    <slot />
  </main>
  <BlogFooter />
</HomeLayout>
