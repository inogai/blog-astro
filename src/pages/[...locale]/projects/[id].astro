---
import { Icon } from 'astro-icon/components'
import { getCollection, render } from 'astro:content'
import Badge from '@/components/projects/Badge.astro'
import TechStack from '@/components/projects/TechStack.astro'
import { t } from '@/i18n/ui'
import BaseLayout from '@/layouts/BaseLayout.astro'
import { buildBadges } from '@/lib/badge-builder'
import { getI18nStaticPaths } from '@/lib/i18n-utils'

export async function getStaticPaths() {
  const projects = await getCollection('projects')
  // Only generate detail pages for featured projects
  const featuredProjects = projects.filter(p => p.data.featured)
  return getI18nStaticPaths(
    featuredProjects.map(project => ({
      id: project.id,
      props: { project },
    })),
  )
}

const { project } = Astro.props
const { Content } = await render(project)

const { title, description, techStack, github, demo, status, featured } = project.data

const badges = buildBadges({
  featured,
  status,
  github,
  demo,
})
---

<BaseLayout
  title={title}
  breadcrumb={{
    overrides: [
      {
        href: Astro.url.pathname,
        label: title,
      },
    ],
  }}
>
  <article class="max-w-3xl">
    <header class="mb-8">
      <div class="mb-4 flex items-center gap-3">
        <h1 class="text-4xl font-extrabold tracking-tight lg:text-5xl">
          {title}
        </h1>
        {badges.map(({ type }) => <Badge type={type} size="md" />)}
      </div>

      <p class="mb-4 text-xl text-muted-foreground">
        {description}
      </p>

      <TechStack items={techStack} />
    </header>

    <div class="prose max-w-none">
      <Content />
    </div>

    <div class="mt-12 border-t pt-6">
      <a
        href={`/${Astro.params.locale}/projects/`}
        class={`
          inline-flex items-center gap-1.5 text-sm text-muted-foreground
          transition-colors
          hover:text-foreground
        `}
      >
        <Icon name="mdi:arrow-left" class="size-4" />
        {t('projects.backToProjects')}
      </a>
    </div>
  </article>
</BaseLayout>
