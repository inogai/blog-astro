---
import type { Project } from '@/types/Project'
import { Icon } from 'astro-icon/components'
import TechStack from './TechStack.astro'

interface Props {
  project: Project
  showDetailLink?: boolean
}

const { project, showDetailLink = false } = Astro.props
const { title, description, techStack, github, demo, featured, status } =
  project.data

const locale = Astro.params.locale || 'en'
const detailHref = `/${locale}/projects/${project.id}/`

// Determine the primary link
const primaryLink = showDetailLink ? detailHref : github || demo
---

<a
  href={primaryLink}
  target={showDetailLink ? '_self' : '_blank'}
  rel={showDetailLink ? '' : 'noopener noreferrer'}
  class:list={[
    'group -mx-3 block rounded-lg px-3 py-4 transition-colors',
    'hover:bg-muted/50',
  ]}
>
  <div class="flex items-start justify-between gap-4">
    <div class="min-w-0 flex-1">
      <div class="flex items-center gap-2">
        <h3 class="text-lg font-medium group-hover:underline">
          {title}
        </h3>
        {
          featured && (
            <span class="text-amber-500" title="Featured">
              <Icon name="mdi:star" class="size-4" />
            </span>
          )
        }
        {
          status === 'archived' && (
            <span
              class={`
                rounded bg-muted px-1.5 py-0.5 text-xs text-muted-foreground
              `}
            >
              Archived
            </span>
          )
        }
        {
          status === 'active' && (
            <span
              class={`
                rounded bg-green-100 px-1.5 py-0.5 text-xs text-green-600
                dark:bg-green-900/30 dark:text-green-400
              `}
            >
              Ongoing
            </span>
          )
        }{
          github && (
            <button
              onclick={`event.stopPropagation(); window.open('${github}', '_blank')`}
              class="text-muted-foreground hover:text-foreground bg-transparent border-0 p-0 cursor-pointer"
              title="GitHub Repository"
            >
              <Icon name="mdi:github" class="size-4" />
            </button>
          )
        }
      </div>
      <p class="mt-1 line-clamp-2 text-muted-foreground">
        {description}
      </p>
      <div class="mt-2">
        <TechStack items={techStack} />
      </div>
    </div>
    <div
      class={`
        flex-shrink-0 text-muted-foreground transition-colors
        group-hover:text-foreground
      `}
    >
      {
        showDetailLink ? (
          <Icon name="mdi:chevron-right" class="size-5" />
        ) : (
          <Icon name="mdi:arrow-top-right" class="size-5" />
        )
      }
    </div>
  </div>
</a>
